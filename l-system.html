<html>
	<head>
		<meta charset="utf-8">
		<title>Algorythmic Botany</title>
		<link href="style.css" rel="stylesheet">
		<link href="media.css" rel="stylesheet">
		<script type="text/javascript" src="processing.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

		<!-- Tooltip vars for localisation purposes. -->
		<script>
			var FIELD_A_TIP = "A: Put a single letter here, which will be translated into B."
			var FIELD_B_TIP = "B: Put a string here, A will be translated into it."
			var FIELD_PROB_TIP = "Prob: Put a number 0-100 here, it's the probability of this translation."
		</script>

		<!-- Rule fields generation -->
		<script>
			function add_input()
			{
				// If only I knew what's this used for, CHRISBARD. ~Luduk.
				/*
			    var inputs = $('.inputs input[type="text"]');
			    var new_id = inputs.length + 1;
			    */

			    $('.inputs').append(`<p>
			    	                 <div class="tooltip"><input maxlength="1"></br><span class="tooltiptext">${FIELD_A_TIP}</span></div>
			    	                 <div class="tooltip"><input title="symbols"></br><span class="tooltiptext">${FIELD_B_TIP}</span></div>
			    	                 <div class="tooltip"><input type="number" maxlength="3"></br><span class="tooltiptext">${FIELD_PROB_TIP}</span></div>
			    	                 <input type="button" value="Delete" onclick="removeDiv(this);">
			    	                 </p>`
			    );

			$("ul").on("click", "button", function(e)
			                            		{
			                                  		e.preventDefault();
													$(this).parent().remove();
												}
			);
			}
		</script>

		<!-- Array for use inside Processing app. -->
		<script>
			let fields = document.getElementsByTagName("input");
			var saved_array = [];
			
			function save()
			{
			  for(i = 0; i <= fields.length; i++)
			  {
			      saved_array[i] = fields[i].value; 
			  }

			  newRules = true;
			  updateTree = true;
			}
			    
		</script>

		<!-- Removing buttons. -->
		<script>
			function removeDiv(that)
			{
			    var div=that.parentNode;
			    div.parentNode.removeChild(div);
			}
		</script>

		<!--[if lt IE 9]>
		<script src="http://css3-mediaqueries-js.googlecode.com/files/css3-mediaqueries.js"></script>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		![endif]-->

		<script>
			var clientX = 0;
			var clientY = 0;
			var pclientX = 0;
			var pclientY = 0;
			var pressedMouse = false;
			var updateTree = false;
			var newRules = false;

			function init()
			{
				theCanvas = document.getElementById("theCanvas");
				theCanvas.addEventListener("mousemove", onMouseMove, false);
				theCanvas.addEventListener("mousedown", onMouseDown, false);
				theCanvas.addEventListener("mouseup", onMouseUp, false);
				theCanvas.addEventListener("touchstart", onTouchStart, false);
				theCanvas.addEventListener("touchmove", onTouchMove, false);
				theCanvas.addEventListener("touchend", onTouchEnd, false);
			}

			function update_tree()
			{
				updateTree = true;
			}

			function getSliderValue(slider_id)
			{
				return document.getElementsById(slider_id).value;
			}

			function hslSetColor(h, s, b)
			{
				// Also does conversion from hsb to hsl.
				let l = (2 - s / 100.0) * b / 2;
				if(l != 0)
				{
					if(l == 100.0)
					{
						s = 0;
					}
					else if(l < 50.0)
					{
						s = (s * b) / (l * 2);
					}
					else
					{
						s = (s * b) / (200.0 - l * 2);
					}
				}
				document.body.style.backgroundColor = `hsl(${h}, ${s}%, ${l}%)`;
			}

			function getActualPos(x, y)
			{
				let rect = theCanvas.getBoundingClientRect();
				let scaleX = theCanvas.width / rect.width;
				let scaleY = theCanvas.height / rect.height;
				return {
						x: (x - rect.left) * scaleX,
						y: (y - rect.top * scaleY)
						}
			}

			function onMouseMove(event)
			{
				event.preventDefault();
				pclientX = clientX;
				pclientY = clientY;
				let pos = getActualPos(event.clientX, event.clientY)
				clientX = pos.x;
				clientY = pos.y;
			}

			function onMouseDown(event)
			{
				event.preventDefault();
				pclientX = clientX;
				pclientY = clientY;
				var pos = getActualPos(event.clientX, event.clientY)
				clientX = pos.x;
				clientY = pos.y;
				pressedMouse = true;
			}

			function onMouseUp(event)
			{
				event.preventDefault();
				pressedMouse = false;
			}

			function onTouchMove(event)
			{
				event.preventDefault();
				pclientX = clientX;
				pclientY = clientY;
				let firstTouch = event.touches[0];
				let pos = getActualPos(firstTouch.clientX, firstTouch.clientY)
				clientX = pos.x;
				clientY = pos.y;
			}

			function onTouchStart(event)
			{
				event.preventDefault();
				pclientX = clientX;
				pclientY = clientY;
				let firstTouch = event.touches[0];
				let pos = getActualPos(firstTouch.clientX, firstTouch.clientY)
				clientX = pos.x;
				clientY = pos.y;
				pressedMouse = true;
			}

			function onTouchEnd()
			{
				event.preventDefault();
				pressedMouse = false;
			}
		</script>

		<!-- Hiding the rules. -->
		<script>
			$(document).ready(function()
				{
					$("#showHideContent").click(function()
						{
							if($(".inputs").is(":hidden"))
							{
								$(".inputs").show("slow");
							}
							else
							{
								$(".inputs").hide("slow");
							}
							return false;
						}
					);
				}
			);
		</script>
	</head>
	<body onLoad = init()>
		<header>
			<div class="container">
				<a href="#" id="logo" target="_blank"><img height="60px" src="logo.png"></a>
				<input type="checkbox" id="toggle-1">
				<nav>
					<ul>
						<li><a href="#">Home</a></li>
						<li><a href="#">L-system</a></li>
						<li><a href="#">About</a></li>
						<li><a href="#">Button 1</a></li>
						<li><a href="#">Button 2</a></li>
					</ul>
				</nav>
			</div>
		</header>
		<div class="slidecontainer">
			<div class="tooltip">
				<input type="range" min="1" max="100" value="50" class="slider" id="myRange1" oninput="update_tree()"> </br>
				<span class="tooltiptext">Tooltip text</span>
			</div>
			<div class="tooltip">
				<input type="range" min="1" max="100" value="50" class="slider" id="myRange2" oninput="update_tree()"> </br>
				<span class="tooltiptext">Tooltip text</span>
			</div>
			<div class="tooltip">
				<input type="range" min="1" max="100" value="50" class="slider" id="myRange3" oninput="update_tree()"> </br>
				<span class="tooltiptext">Tooltip text</span>
			</div>
			<div class="tooltip">
				<input type="range" min="1" max="100" value="50" class="slider" id="myRange4" oninput="update_tree()"> </br>
				<span class="tooltiptext">Tooltip text</span>
			</div>
		</div>
		<form id="Form">
			<div class="inputs"></div>
			<input type="button" onclick="add_input()" value="Add" />
			<input type="button" value="Submit" onclick="save()"></input> </br>
			<button id="showHideContent">Show/Hide</button>
		</form>
		<canvas id="theCanvas" data-processing-sources="./l-system.pde"></canvas>
	</body>
</html>
